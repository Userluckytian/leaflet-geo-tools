!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@turf/turf"),require("leaflet")):"function"==typeof define&&define.amd?define(["exports","@turf/turf","leaflet"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LeafletGeoTools={},t.turf,t.L)}(this,function(t,e,r){"use strict";function o(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,Object.freeze(e)}var n=o(r),i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},i(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var s,l=function(){return l=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},l.apply(this,arguments)};function p(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError,t.PolygonEditorState=void 0,(s=t.PolygonEditorState||(t.PolygonEditorState={})).Idle="idle",s.Drawing="drawing",s.Editing="editing";var h=function(){function r(e,r){void 0===r&&(r={});var o=this;this.circleLayer=null,this.drawLayerStyle={color:"red",fillColor:"red",fillOpacity:.3},this.center=null,this.radius=0,this.tempCoords=[],this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){if(0===o.tempCoords.length)o.tempCoords.push(t.latlng);else{var e=[o.tempCoords[0],t.latlng];o.renderLayer(e),o.reset()}},this.mapMouseMoveEvent=function(t){if(o.tempCoords.length){var e=t.latlng;o.tempCoords.length>0&&(o.tempCoords=[o.tempCoords[0],e]),o.renderLayer(o.tempCoords)}},this.map=e,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.map.getContainer().style.cursor="crosshair",this.map.doubleClickZoom.disable(),this.initLayers(r),this.initMapEvent(this.map))}return r.prototype.initLayers=function(t){var e=l(l({pane:"overlayPane",radius:0},this.drawLayerStyle),t);this.circleLayer=n.circle([181,181],e),this.circleLayer.addTo(this.map)},r.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("mousemove",this.mapMouseMoveEvent)},r.prototype.renderLayer=function(t){if(!this.circleLayer)throw new Error("图层不存在，无法渲染");this.center=t[0],this.radius=this.center.distanceTo(t[1]),this.circleLayer.setLatLng(this.center),this.circleLayer.setRadius(this.radius)},r.prototype.reset=function(){this.tempCoords=[],this.offMapEvent(this.map),this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},r.prototype.geojson=function(){if(this.circleLayer&&this.center){var t=[this.center.lng,this.center.lat];return e.circle(t,this.radius/1e3,{steps:64,units:"kilometers",properties:{type:"circle"}})}throw new Error("未捕获到图层，无法获取到geojson数据")},r.prototype.destroy=function(){this.circleLayer&&(this.circleLayer.remove(),this.circleLayer=null),this.reset()},r.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("mousemove",this.mapMouseMoveEvent)},r.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},r.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},r.prototype.clearAllStateListeners=function(){this.stateListeners=[]},r.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},r}(),c=function(){function e(e,r){void 0===r&&(r={});var o=this;this.markerLayer=null,this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){o.markerLayer&&(o.markerLayer.setLatLng([t.latlng.lat,t.latlng.lng]),o.reset())},this.map=e,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.map.getContainer().style.cursor="crosshair",this.initLayers(r),this.initMapEvent(this.map))}return e.prototype.initLayers=function(t){var r=l({pane:"markerPane",icon:e.markerIcon},t);this.markerLayer=n.marker([181,181],r),this.markerLayer.addTo(this.map)},e.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent)},e.prototype.reset=function(){this.map.off("click",this.mapClickEvent),this.map.getContainer().style.cursor="grab",this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},e.prototype.geojson=function(){if(this.markerLayer)return this.markerLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},e.prototype.destroy=function(){this.markerLayer&&(this.markerLayer.remove(),this.markerLayer=null),this.reset()},e.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},e.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},e.prototype.clearAllStateListeners=function(){this.stateListeners=[]},e.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},e.markerIcon=n.divIcon({className:"draw-marker-icon",html:'<div style="width: 16px; height: 16px; border-radius: 8px; overflow: hidden; border: solid 1px red; background: #ff000048"></div>'}),e}(),u=function(){function e(e,r){void 0===r&&(r={});var o=this;this.polygonLayer=null,this.drawLayerStyle={color:"red",fillColor:"red",fillOpacity:.3},this.tempCoords=[],this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){o.tempCoords.push([t.latlng.lat,t.latlng.lng])},this.mapDblClickEvent=function(t){if(o.polygonLayer){var e=o.deduplicateCoordinates(o.tempCoords);o.renderLayer(p(p([],e,!0),[e[0]],!1)),o.reset()}},this.mapMouseMoveEvent=function(t){if(o.tempCoords.length){var e=[t.latlng.lat,t.latlng.lng];1===o.tempCoords.length&&(o.tempCoords=[o.tempCoords[0],e]);var r=o.tempCoords.slice(0,o.tempCoords.length-1);o.tempCoords=p(p([],r,!0),[e],!1),o.renderLayer(o.tempCoords)}},this.map=e,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.map.getContainer().style.cursor="crosshair",this.map.doubleClickZoom.disable(),this.initLayers(r),this.initMapEvent(this.map))}return e.prototype.initLayers=function(t){var e=l(l({pane:"overlayPane"},this.drawLayerStyle),t);this.polygonLayer=n.polygon([[181,181],[181,181],[181,181],[181,181]],e),this.polygonLayer.addTo(this.map)},e.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("dblclick",this.mapDblClickEvent),t.on("mousemove",this.mapMouseMoveEvent)},e.prototype.reset=function(){this.tempCoords=[],this.offMapEvent(this.map),this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},e.prototype.renderLayer=function(t){if(!this.polygonLayer)throw new Error("图层不存在，无法渲染");this.polygonLayer.setLatLngs(t)},e.prototype.geojson=function(){if(this.polygonLayer)return this.polygonLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},e.prototype.destroy=function(){this.polygonLayer&&(this.polygonLayer.remove(),this.polygonLayer=null),this.reset()},e.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("dblclick",this.mapDblClickEvent),t.off("mousemove",this.mapMouseMoveEvent)},e.prototype.deduplicateCoordinates=function(t,e){if(void 0===e&&(e=6),!Array.isArray(t)||0===t.length)return[];for(var r=[t[0]],o=1;o<t.length;o++){var n=t[o],i=t[o-1];n[0].toFixed(e)===i[0].toFixed(e)&&n[1].toFixed(e)===i[1].toFixed(e)||r.push(n)}return r},e.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},e.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},e.prototype.clearAllStateListeners=function(){this.stateListeners=[]},e.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},e}(),d=function(){function e(e,r){void 0===r&&(r={});var o=this;this.lineLayer=null,this.drawLayerStyle={color:"red",fillColor:"red",fillOpacity:.3},this.tempCoords=[],this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){o.tempCoords.push([t.latlng.lat,t.latlng.lng])},this.mapDblClickEvent=function(t){if(o.lineLayer){var e=o.deduplicateCoordinates(o.tempCoords);o.renderLayer(e),o.reset()}},this.mapMouseMoveEvent=function(t){if(o.tempCoords.length){var e=[t.latlng.lat,t.latlng.lng];1===o.tempCoords.length&&(o.tempCoords=[o.tempCoords[0],e]);var r=o.tempCoords.slice(0,o.tempCoords.length-1);o.tempCoords=p(p([],r,!0),[e],!1),o.renderLayer(o.tempCoords)}},this.map=e,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.map.getContainer().style.cursor="crosshair",this.map.doubleClickZoom.disable(),this.initLayers(r),this.initMapEvent(this.map))}return e.prototype.initLayers=function(t){var e=l(l({pane:"overlayPane"},this.drawLayerStyle),t);this.lineLayer=n.polyline([[181,181],[182,182]],e),this.lineLayer.addTo(this.map)},e.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("dblclick",this.mapDblClickEvent),t.on("mousemove",this.mapMouseMoveEvent)},e.prototype.reset=function(){this.tempCoords=[],this.offMapEvent(this.map),this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle),this.clearAllStateListeners()},e.prototype.renderLayer=function(t){if(!this.lineLayer)throw new Error("图层不存在，无法渲染");this.lineLayer.setLatLngs(t)},e.prototype.geojson=function(){if(this.lineLayer)return this.lineLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},e.prototype.destroy=function(){this.lineLayer&&(this.map.removeLayer(this.lineLayer),this.lineLayer.remove(),this.lineLayer=null),this.reset()},e.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("dblclick",this.mapDblClickEvent),t.off("mousemove",this.mapMouseMoveEvent)},e.prototype.deduplicateCoordinates=function(t,e){if(void 0===e&&(e=6),!Array.isArray(t)||0===t.length)return[];for(var r=[t[0]],o=1;o<t.length;o++){var n=t[o],i=t[o-1];n[0].toFixed(e)===i[0].toFixed(e)&&n[1].toFixed(e)===i[1].toFixed(e)||r.push(n)}return r},e.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},e.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},e.prototype.clearAllStateListeners=function(){this.stateListeners=[]},e.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},e}(),y=function(){function e(e,r){void 0===r&&(r={});var o=this;this.rectangleLayer=null,this.drawLayerStyle={color:"red",fillColor:"red",fillOpacity:.3},this.tempCoords=[],this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){if(0===o.tempCoords.length)o.tempCoords.push(t.latlng);else{var e=[o.tempCoords[0],t.latlng];o.renderLayer(e),o.reset()}},this.mapMouseMoveEvent=function(t){if(o.tempCoords.length){var e=t.latlng;o.tempCoords.length>0&&(o.tempCoords=[o.tempCoords[0],e]),o.renderLayer(o.tempCoords)}},this.map=e,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.map.getContainer().style.cursor="crosshair",this.map.doubleClickZoom.disable(),this.initLayers(r),this.initMapEvent(this.map))}return e.prototype.initLayers=function(t){var e=l(l({pane:"overlayPane"},this.drawLayerStyle),t);this.rectangleLayer=n.rectangle([[181,181],[182,182]],e),this.rectangleLayer.addTo(this.map)},e.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("mousemove",this.mapMouseMoveEvent)},e.prototype.reset=function(){this.tempCoords=[],this.offMapEvent(this.map),this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},e.prototype.renderLayer=function(t){if(!this.rectangleLayer)throw new Error("图层不存在，无法渲染");var e=n.latLngBounds(t);this.rectangleLayer.setBounds(e)},e.prototype.geojson=function(){if(this.rectangleLayer)return this.rectangleLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},e.prototype.destroy=function(){this.rectangleLayer&&(this.rectangleLayer.remove(),this.rectangleLayer=null),this.reset()},e.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("mousemove",this.mapMouseMoveEvent)},e.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},e.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},e.prototype.clearAllStateListeners=function(){this.stateListeners=[]},e.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},e}(),f=function(){function e(e){if(this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.isDraggingPolygon=!1,this.dragStartLatLng=null,this.isVisible=!0,!e)throw new Error("传入的地图对象异常，请先确保地图对象已实例完成。");this.map=e}return e.prototype.activate=function(){var t=e.currentActiveEditor;t&&t!==this&&(t.forceExitEditMode(),t.deactivate()),e.currentActiveEditor=this},e.prototype.deactivate=function(){e.currentActiveEditor===this&&(e.currentActiveEditor=null)},e.prototype.isActive=function(){return e.currentActiveEditor===this&&this.isVisible},e.deactivateAllEditors=function(){e.currentActiveEditor&&e.currentActiveEditor.deactivate()},e.prototype.forceExitEditMode=function(){this.exitEditMode(),this.currentState===t.PolygonEditorState.Editing&&this.updateAndNotifyStateChange(t.PolygonEditorState.Idle),this.isDraggingPolygon=!1,this.dragStartLatLng=null},e.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},e.prototype.setCurrentState=function(t){this.currentState=t},e.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},e.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},e.prototype.clearAllStateListeners=function(){this.stateListeners=[]},e.currentActiveEditor=null,e}(),g=function(r){function o(o,n,i){void 0===n&&(n={});var a=r.call(this,o)||this;if(a.polygonLayer=null,a.drawLayerStyle={weight:2,color:"red",fillColor:"red",fillOpacity:.3,fill:!0},a.tempCoords=[],a.mapClickEvent=function(e){a.isActive()&&(a.currentState!==t.PolygonEditorState.Drawing||a.tempCoords.push([e.latlng.lat,e.latlng.lng]))},a.mapDblClickEvent=function(r){if(a.canConsume(r)){if(!a.polygonLayer)throw new Error("面图层实例化失败，无法完成图层创建，请重试");if(a.currentState===t.PolygonEditorState.Drawing){var o=a.deduplicateCoordinates(a.tempCoords),n=[p(p([],o,!0),[o[0]],!1)];return a.renderLayer([n]),a.tempCoords=[],a.reset(),void a.updateAndNotifyStateChange(t.PolygonEditorState.Idle)}var i=r.latlng,s=a.polygonLayer.toGeoJSON(),l=e.point([i.lng,i.lat]);e.booleanPointInPolygon(l,s)&&a.currentState!==t.PolygonEditorState.Editing?(a.map.doubleClickZoom.disable(),a.updateAndNotifyStateChange(t.PolygonEditorState.Editing),a.isActive(),a.enterEditMode()):a.commitEdit()}},a.mapMouseMoveEvent=function(e){if(a.isActive()){if(a.currentState===t.PolygonEditorState.Drawing){if(!a.tempCoords.length)return;var r=[e.latlng.lat,e.latlng.lng];1===a.tempCoords.length&&(a.tempCoords=[a.tempCoords[0],r]);var o=a.tempCoords.slice(0,a.tempCoords.length-1);return a.tempCoords=p(p([],o,!0),[r],!1),void a.renderLayer([[a.tempCoords]])}if(a.currentState===t.PolygonEditorState.Editing&&a.isDraggingPolygon&&a.dragStartLatLng){var n=e.latlng.lat-a.dragStartLatLng.lat,i=e.latlng.lng-a.dragStartLatLng.lng;a.vertexMarkers.forEach(function(t){t.forEach(function(t){t.forEach(function(t){var e=t.getLatLng();t.setLatLng([e.lat+n,e.lng+i])})})});var s=a.vertexMarkers.map(function(t){return t.map(function(t){return t.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]})})});a.renderLayer(s),a.updateMidpoints(),a.dragStartLatLng=e.latlng}}},a.mapMouseUpEvent=function(e){if(a.isActive()&&a.currentState===t.PolygonEditorState.Editing&&a.isDraggingPolygon){a.isDraggingPolygon=!1,a.dragStartLatLng=null,a.map.dragging.enable();var r=a.vertexMarkers.map(function(t){return t.map(function(t){return t.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]})})});return a.renderLayer(r),a.historyStack.push(r),void a.updateMidpoints()}},a.map){a.activate();var s=!!i;a.updateAndNotifyStateChange(s?t.PolygonEditorState.Idle:t.PolygonEditorState.Drawing),a.map.getContainer().style.cursor=s?"grab":"crosshair",s?a.map.doubleClickZoom.enable():a.map.doubleClickZoom.disable(),a.initLayers(n,s?i:void 0),a.initMapEvent(a.map)}return a}return a(o,r),o.prototype.initLayers=function(t,e){var r=l(l({pane:"overlayPane",defaultStyle:this.drawLayerStyle},this.drawLayerStyle),t),o=[[181,181],[181,181],[181,181],[181,181]];e&&(o=this.convertGeoJSONToLatLngs(e)),this.polygonLayer=n.polygon(o,r),this.polygonLayer.addTo(this.map),this.initPolygonEvent()},o.prototype.initPolygonEvent=function(){var e=this;this.polygonLayer&&this.polygonLayer.on("mousedown",function(r){e.isActive()&&e.currentState===t.PolygonEditorState.Editing&&(e.isDraggingPolygon=!0,e.dragStartLatLng=r.latlng,e.map.dragging.disable())})},o.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("dblclick",this.mapDblClickEvent),t.on("mousemove",this.mapMouseMoveEvent),t.on("mouseup",this.mapMouseUpEvent)},o.prototype.renderLayer=function(t){if(!this.polygonLayer)throw new Error("图层不存在，无法渲染");var e=t.map(function(t){return t.map(function(t){return t.map(function(t){var e=t[0],r=t[1];return n.latLng(e,r)})})});this.polygonLayer.setLatLngs(e)},o.prototype.geojson=function(){if(this.polygonLayer)return this.polygonLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},o.prototype.getLayer=function(){return this.polygonLayer},o.prototype.show=function(){var t;this.isVisible=!0,null===(t=this.polygonLayer)||void 0===t||t.setStyle(this.polygonLayer.options.defaultStyle)},o.prototype.hide=function(){var e;this.isVisible=!1;null===(e=this.polygonLayer)||void 0===e||e.setStyle({color:"red",weight:0,fill:!1,fillColor:"red",fillOpacity:0}),this.currentState===t.PolygonEditorState.Editing&&(this.exitEditMode(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle))},o.prototype.setVisible=function(t){t?this.show():this.hide()},o.prototype.destroy=function(){this.destroyLayer(),this.deactivate(),this.exitEditMode(),this.offMapEvent(this.map),this.reset(),this.clearAllStateListeners(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},o.prototype.destroyLayer=function(){this.tempCoords=[],this.polygonLayer&&(this.polygonLayer.remove(),this.polygonLayer=null)},o.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("dblclick",this.mapDblClickEvent),t.off("mousemove",this.mapMouseMoveEvent),t.off("mouseup",this.mapMouseUpEvent)},o.prototype.deduplicateCoordinates=function(t,e){if(void 0===e&&(e=6),!Array.isArray(t)||0===t.length)return[];for(var r=[t[0]],o=1;o<t.length;o++){var n=t[o],i=t[o-1];n[0].toFixed(e)===i[0].toFixed(e)&&n[1].toFixed(e)===i[1].toFixed(e)||r.push(n)}return r},o.prototype.enterEditMode=function(){if(this.polygonLayer){var t,e=this.polygonLayer.getLatLngs();t=Array.isArray(e[0][0])?e.map(function(t){return t.map(function(t){return t.map(function(t){return[t.lat,t.lng]})})}):[e.map(function(t){return t.map(function(t){return[t.lat,t.lng]})})],this.historyStack.push(t),this.redoStack=[],this.reBuildMarker(t),this.insertMidpointMarkers()}},o.prototype.exitEditMode=function(){var t=this;this.vertexMarkers.flat(2).forEach(function(e){t.map.removeLayer(e)}),this.vertexMarkers=[],this.midpointMarkers.flat(2).forEach(function(e){t.map.removeLayer(e)}),this.midpointMarkers=[]},o.prototype.insertMidpointMarkers=function(){var e=this;this.polygonLayer&&this.currentState===t.PolygonEditorState.Editing&&(this.midpointMarkers.flat(2).forEach(function(t){return e.map.removeLayer(t)}),this.midpointMarkers=[],this.vertexMarkers.forEach(function(t,r){var o=[];t.forEach(function(t,i){for(var a=[],s=function(o){var s=(o+1)%t.length,l=t[o].getLatLng(),p=t[s].getLatLng(),h=n.latLng((l.lat+p.lat)/2,(l.lng+p.lng)/2),c=n.circleMarker(h,{radius:6,color:"#ff0000",fillColor:"#ffffff",opacity:.8,fillOpacity:.8,weight:1}).addTo(e.map);c.on("click",function(){var t=n.marker(h,{draggable:!0,icon:e.buildMarkerIcon()}).addTo(e.map);e.vertexMarkers[r][i].splice(s,0,t),t.on("drag",function(){e.renderLayerFromMarkers(),e.updateMidpoints()}),t.on("dragend",function(){e.pushHistoryFromMarkers()}),t.on("contextmenu",function(){var o=e.vertexMarkers[r][i];if(o.length>3){var n=o.findIndex(function(e){return e===t});-1!==n&&(e.map.removeLayer(t),o.splice(n,1),e.renderLayerFromMarkers(),e.pushHistoryFromMarkers(),e.updateMidpoints())}else alert("环点数不能少于3个")}),e.renderLayerFromMarkers(),e.pushHistoryFromMarkers(),e.updateMidpoints()}),a.push(c)},l=0;l<t.length;l++)s(l);o.push(a)}),e.midpointMarkers.push(o)}))},o.prototype.updateMidpoints=function(){var t=this;this.midpointMarkers.flat(2).forEach(function(e){return t.map.removeLayer(e)}),this.midpointMarkers=[],this.insertMidpointMarkers()},o.prototype.buildMarkerIcon=function(t,e,r){void 0===t&&(t="border-radius: 50%;background: #ffffff;border: solid 3px red;"),void 0===e&&(e=[20,20]);var o="width:".concat(e[0],"px; height: ").concat(e[1],"px;");return n.divIcon(l({className:"edit-polygon-marker",html:'<div style="'.concat(t+o,'"></div>'),iconSize:e},r))},o.prototype.reBuildMarkerAndRender=function(t){this.renderLayer(t),this.reBuildMarker(t),this.updateMidpoints()},o.prototype.reBuildMarker=function(t){var e=this;this.vertexMarkers.flat(2).forEach(function(t){return e.map.removeLayer(t)}),this.vertexMarkers=[],t.forEach(function(t,r){var o=[];t.forEach(function(t,i){var a=[];t.forEach(function(t,o){var s=n.latLng(t[0],t[1]),l=n.marker(s,{draggable:!0,icon:e.buildMarkerIcon()}).addTo(e.map);l.on("drag",function(){e.renderLayerFromMarkers(),e.updateMidpoints()}),l.on("dragend",function(){e.pushHistoryFromMarkers()}),l.on("contextmenu",function(){var t=e.vertexMarkers[r][i];if(t.length>3){e.map.removeLayer(l);var o=t.findIndex(function(t){return t===l});-1!==o&&(t.splice(o,1),e.renderLayerFromMarkers(),e.pushHistoryFromMarkers(),e.updateMidpoints())}else alert("环点数不能少于3个")}),a.push(l)}),o.push(a)}),e.vertexMarkers.push(o)})},o.prototype.renderLayerFromMarkers=function(){var t=this.vertexMarkers.map(function(t){return t.map(function(t){return t.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]})})});this.renderLayer(t)},o.prototype.pushHistoryFromMarkers=function(){var t=this.vertexMarkers.map(function(t){return t.map(function(t){return t.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]})})});this.historyStack.push(t)},o.prototype.isClickOnMyLayer=function(t){if(!this.polygonLayer)return!1;try{var r=this.polygonLayer.toGeoJSON(),o=e.point([t.latlng.lng,t.latlng.lat]);return e.booleanPointInPolygon(o,r)}catch(t){return console.error("检查点击图层时出错:",t),!1}},o.prototype.canConsume=function(t){if(!this.isVisible)return!1;var e=this.isClickOnMyLayer(t);return this.isActive()?e:!!e&&(this.activate(),!0)},o.prototype.convertGeoJSONToLatLngs=function(t){if("Polygon"===t.type)return t.coordinates.map(function(t){return t.map(function(t){var e=t[0];return[t[1],e]})});if("MultiPolygon"===t.type)return t.coordinates.map(function(t){return t.map(function(t){return t.map(function(t){var e=t[0];return[t[1],e]})})});throw new Error("不支持的 geometry 类型: "+t.type)},o}(function(e){function r(t){var r=e.call(this,t)||this;return r.vertexMarkers=[],r.midpointMarkers=[],r.historyStack=[],r.redoStack=[],r}return a(r,e),r.prototype.undoEdit=function(){if(!(this.historyStack.length<2)){var t=this.historyStack.pop();t&&this.redoStack.push(t);var e=this.historyStack[this.historyStack.length-1];this.reBuildMarkerAndRender(e)}},r.prototype.redoEdit=function(){if(this.redoStack.length){var t=this.redoStack.pop();t&&(this.historyStack.push(t),this.reBuildMarkerAndRender(t))}},r.prototype.resetToInitial=function(){if(this.historyStack.length){var t=this.historyStack[this.historyStack.length-1],e=this.historyStack[0];this.redoStack.push(t),this.reBuildMarkerAndRender(e)}},r.prototype.commitEdit=function(){var e=this.vertexMarkers.map(function(t){return t.map(function(t){return t.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]})})});this.historyStack=[e],this.redoStack=[],this.exitEditMode(),this.deactivate(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle),this.reset()},r.prototype.reset=function(){this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable()},r}(f)),m=function(r){function o(o,n,i){void 0===n&&(n={});var a=r.call(this,o)||this;if(a.rectangleLayer=null,a.drawLayerStyle={color:"red",fillColor:"red",fillOpacity:.3},a.tempCoords=[],a.mapClickEvent=function(e){if(a.isActive()&&a.currentState===t.PolygonEditorState.Drawing)if(0===a.tempCoords.length)a.tempCoords.push(e.latlng);else{var r=[a.tempCoords[0],e.latlng];a.renderLayer(r),a.tempCoords=[],a.reset(),a.updateAndNotifyStateChange(t.PolygonEditorState.Idle)}},a.mapDblClickEvent=function(r){if(a.canConsume(r)){if(!a.rectangleLayer)throw new Error("图层实例化失败，无法完成图层创建，请重试");var o=r.latlng,n=a.rectangleLayer.toGeoJSON(),i=e.point([o.lng,o.lat]);e.booleanPointInPolygon(i,n)?a.currentState!==t.PolygonEditorState.Editing&&(a.map.doubleClickZoom.disable(),a.updateAndNotifyStateChange(t.PolygonEditorState.Editing),a.isActive(),a.enterEditMode()):a.commitEdit()}},a.mapMouseMoveEvent=function(e){if(a.isActive()){if(a.currentState===t.PolygonEditorState.Drawing){if(!a.tempCoords.length)return;var r=e.latlng;a.tempCoords.length>0&&(a.tempCoords=[a.tempCoords[0],r]),a.renderLayer(a.tempCoords)}if(a.currentState===t.PolygonEditorState.Editing&&a.isDraggingPolygon&&a.dragStartLatLng){var o=e.latlng.lat-a.dragStartLatLng.lat,n=e.latlng.lng-a.dragStartLatLng.lng;a.vertexMarkers.forEach(function(t){var e=t.getLatLng();t.setLatLng([e.lat+o,e.lng+n])});var i=a.vertexMarkers.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]});a.renderLayerFromCoords(i),a.dragStartLatLng=e.latlng}}},a.mapMouseUpEvent=function(e){if(a.isActive()&&a.currentState===t.PolygonEditorState.Editing&&a.isDraggingPolygon){a.isDraggingPolygon=!1,a.dragStartLatLng=null,a.map.dragging.enable();var r=a.vertexMarkers.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]});return a.renderLayerFromCoords(r),void a.historyStack.push(r)}},console.log(a.map),a.map){a.activate();var s=!!i;a.updateAndNotifyStateChange(s?t.PolygonEditorState.Idle:t.PolygonEditorState.Drawing),console.log("???"),a.map.getContainer().style.cursor=s?"grab":"crosshair",s?a.map.doubleClickZoom.enable():a.map.doubleClickZoom.disable(),a.initLayers(n,s?i:void 0),a.initMapEvent(a.map)}return a}return a(o,r),o.prototype.initLayers=function(t,e){var r=l(l({pane:"overlayPane"},this.drawLayerStyle),t),o=[[181,181],[182,182]];e&&(o=this.convertGeoJSONToLatLngs(e)),this.rectangleLayer=n.rectangle(o,r),this.rectangleLayer.addTo(this.map),this.initPolygonEvent()},o.prototype.initPolygonEvent=function(){var e=this;this.rectangleLayer&&this.rectangleLayer.on("mousedown",function(r){e.isActive()&&e.currentState===t.PolygonEditorState.Editing&&(e.isDraggingPolygon=!0,e.dragStartLatLng=r.latlng,e.map.dragging.disable())})},o.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("mousemove",this.mapMouseMoveEvent),t.on("dblclick",this.mapDblClickEvent),t.on("mouseup",this.mapMouseUpEvent)},o.prototype.renderLayer=function(t){if(!this.rectangleLayer)throw new Error("图层不存在，无法渲染");var e=n.latLngBounds(t);this.rectangleLayer.setBounds(e)},o.prototype.renderLayerFromCoords=function(t){if(this.rectangleLayer){var e=t.map(function(t){return n.latLng(t[0],t[1])});this.renderLayer(e)}},o.prototype.geojson=function(){if(this.rectangleLayer)return this.rectangleLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},o.prototype.getLayer=function(){return this.rectangleLayer},o.prototype.destroy=function(){this.destroyLayer(),this.deactivate(),this.exitEditMode(),this.offMapEvent(this.map),this.reset(),this.clearAllStateListeners(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},o.prototype.destroyLayer=function(){this.tempCoords=[],this.rectangleLayer&&(this.rectangleLayer.remove(),this.rectangleLayer=null)},o.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("mousemove",this.mapMouseMoveEvent),t.off("dblclick",this.mapDblClickEvent),t.off("mouseup",this.mapMouseUpEvent)},o.prototype.enterEditMode=function(){if(this.rectangleLayer){var t=this.rectangleLayer.getBounds(),e=[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()].map(function(t){return[t.lat,t.lng]});this.historyStack.push(e),this.reBuildMarker(e)}},o.prototype.exitEditMode=function(){var t=this;this.vertexMarkers.forEach(function(e){t.map.removeLayer(e)}),this.vertexMarkers=[]},o.prototype.buildMarkerIcon=function(t,e,r){void 0===t&&(t="border-radius: 50%;background: #ffffff;border: solid 3px red;"),void 0===e&&(e=[20,20]);var o="width:".concat(e[0],"px; height: ").concat(e[1],"px;");return n.divIcon(l({className:"edit-polygon-marker",html:'<div style="'.concat(t+o,'"></div>'),iconSize:e},r))},o.prototype.reBuildMarkerAndRender=function(t){this.renderLayerFromCoords(t),this.reBuildMarker(t)},o.prototype.reBuildMarker=function(t){var e,r=this;if(this.vertexMarkers.forEach(function(t){return r.map.removeLayer(t)}),this.vertexMarkers=[],2===t.length){var o=t[0],i=t[1],a=o[0],s=o[1],l=i[0],p=i[1],h=Math.max(a,l),c=Math.min(a,l),u=Math.min(s,p),d=Math.max(s,p);e=[n.latLng(h,u),n.latLng(h,d),n.latLng(c,d),n.latLng(c,u)]}else{if(4!==t.length)return void console.error("无效的坐标数量:",t.length);e=t.map(function(t){return n.latLng(t[0],t[1])})}e.forEach(function(t,e){var o=n.marker(t,{draggable:!0,icon:r.buildMarkerIcon()}).addTo(r.map);r.vertexMarkers.push(o),r.bindMarkerEvents(o,e)})},o.prototype.bindMarkerEvents=function(t,e){var r=this;t.on("drag",function(o){var n=o.latlng;t.setLatLng(n),r.updateRectangleCorners(e,n)}),t.on("dragend",function(){var t=r.vertexMarkers.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]});r.historyStack.push(p([],t,!0))})},o.prototype.updateRectangleCorners=function(t,e){var r,o=this,i=this.vertexMarkers.map(function(t){return t.getLatLng()});(r=0===t?[e,n.latLng(e.lat,i[1].lng),n.latLng(i[2].lat,i[1].lng),n.latLng(i[2].lat,e.lng)]:1===t?[n.latLng(e.lat,i[0].lng),e,n.latLng(i[2].lat,e.lng),n.latLng(i[2].lat,i[0].lng)]:2===t?[n.latLng(i[0].lat,i[0].lng),n.latLng(i[0].lat,e.lng),e,n.latLng(e.lat,i[0].lng)]:[n.latLng(i[0].lat,e.lng),n.latLng(i[0].lat,i[1].lng),n.latLng(e.lat,i[1].lng),e]).forEach(function(t,e){o.vertexMarkers[e].setLatLng(t)}),this.renderLayer(r)},o.prototype.isClickOnMyLayer=function(t){if(!this.rectangleLayer)return!1;try{var r=this.rectangleLayer.toGeoJSON(),o=e.point([t.latlng.lng,t.latlng.lat]);return e.booleanPointInPolygon(o,r)}catch(t){return console.error("检查点击图层时出错:",t),!1}},o.prototype.canConsume=function(t){if(!this.isVisible)return!1;var e=this.isClickOnMyLayer(t);return this.isActive()?e:!!e&&(this.activate(),!0)},o.prototype.convertGeoJSONToLatLngs=function(t){if("Polygon"===t.type){var e=t.coordinates[0],r=e.map(function(t){return t[1]}),o=e.map(function(t){return t[0]}),n=Math.min.apply(Math,r),i=Math.max.apply(Math,r);return[[n,Math.min.apply(Math,o)],[i,Math.max.apply(Math,o)]]}throw new Error("不支持的 geometry 类型: "+t.type)},o}(function(e){function r(t){var r=e.call(this,t)||this;return r.vertexMarkers=[],r.midpointMarkers=[],r.historyStack=[],r.redoStack=[],r}return a(r,e),r.prototype.undoEdit=function(){if(!(this.historyStack.length<2)){var t=this.historyStack.pop();t&&this.redoStack.push(t);var e=this.historyStack[this.historyStack.length-1];this.reBuildMarkerAndRender(e)}},r.prototype.redoEdit=function(){if(this.redoStack.length){var t=this.redoStack.pop();t&&(this.historyStack.push(t),this.reBuildMarkerAndRender(t))}},r.prototype.resetToInitial=function(){if(this.historyStack.length){var t=this.historyStack[this.historyStack.length-1],e=this.historyStack[0];this.redoStack.push(t),this.reBuildMarkerAndRender(e)}},r.prototype.commitEdit=function(){var e=this.vertexMarkers.map(function(t){return[t.getLatLng().lat,t.getLatLng().lng]});this.historyStack=[e],this.redoStack=[],this.exitEditMode(),this.deactivate(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle),this.reset()},r.prototype.reset=function(){this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable()},r}(f)),v=1e6,L={zh:{squareMeter:"平方米",hectare:"公顷",squareKilometer:"平方公里"},en:{squareMeter:"m²",hectare:"ha",squareKilometer:"km²"}},k=function(){function r(e,r,o){void 0===r&&(r={precision:2,lang:"zh"}),void 0===o&&(o={});var n=this;this.polygonLayer=null,this.drawLayerStyle={color:"red",fillColor:"red",fillOpacity:.3},this.markerLayer=null,this.tempCoords=[],this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){n.tempCoords.push([t.latlng.lat,t.latlng.lng])},this.mapDblClickEvent=function(t){if(n.polygonLayer){var e=n.deduplicateCoordinates(n.tempCoords);n.renderLayer(p(p([],e,!0),[e[0]],!1)),n.reset()}},this.mapMouseMoveEvent=function(t){if(n.tempCoords.length){var e=[t.latlng.lat,t.latlng.lng];1===n.tempCoords.length&&(n.tempCoords=[n.tempCoords[0],e]);var r=n.tempCoords.slice(0,n.tempCoords.length-1);n.tempCoords=p(p([],r,!0),[e],!1),n.renderLayer(n.tempCoords)}},this.map=e,this.measureOptions=r,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.map.getContainer().style.cursor="crosshair",this.map.doubleClickZoom.disable(),this.initLayers(o),this.initMapEvent(this.map))}return r.prototype.initLayers=function(t){var e=l(l({pane:"overlayPane"},this.drawLayerStyle),t);this.polygonLayer=n.polygon([[181,181],[181,181],[181,181],[181,181]],e),this.polygonLayer.addTo(this.map)},r.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("dblclick",this.mapDblClickEvent),t.on("mousemove",this.mapMouseMoveEvent)},r.prototype.reset=function(){this.tempCoords=[],this.offMapEvent(this.map),this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},r.prototype.renderLayer=function(t){if(!this.polygonLayer)throw new Error("图层不存在，无法渲染");if(this.polygonLayer.setLatLngs(t),t.length>2){this.markerLayer&&(this.markerLayer.remove(),this.markerLayer=null);var r=p(p([],t,!0),[t[0]],!1),o=e.polygon([r]),i=e.area(o),a=this.formatArea(i,this.measureOptions),s=e.center(o).geometry.coordinates,l={pane:"markerPane",icon:this.measureMarkerIcon(a)};this.markerLayer=n.marker(s,l),this.markerLayer.addTo(this.map)}},r.prototype.geojson=function(){if(this.polygonLayer)return this.polygonLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},r.prototype.destroy=function(){this.polygonLayer&&(this.polygonLayer.remove(),this.polygonLayer=null),this.markerLayer&&(this.markerLayer.remove(),this.markerLayer=null),this.reset()},r.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("dblclick",this.mapDblClickEvent),t.off("mousemove",this.mapMouseMoveEvent)},r.prototype.measureMarkerIcon=function(t){return n.divIcon({className:"measure-area-marker",html:'<div style="width: 10px;height: 10px; text-align: center; position: relative;">\n                            \x3c!-- 构建小圆点 --\x3e\n                            <div style="width: 10px;height: 10px;border-radius: 50%;background: #ffffff;border: solid 2px red; position: absolute;left: 1px;top: 1px;"></div>\n                            \x3c!-- 下面的内容展示文字 --\x3e\n                            <div style="width: max-content; padding: 3px; border: solid 1px red; background: #ffffff;  position: absolute; left: 10px; top: 10px;">\n                                '.concat(t.val," ").concat(t.unit,"\n                            </div>\n                        </div>")})},r.prototype.deduplicateCoordinates=function(t,e){if(void 0===e&&(e=6),!Array.isArray(t)||0===t.length)return[];for(var r=[t[0]],o=1;o<t.length;o++){var n=t[o],i=t[o-1];n[0].toFixed(e)===i[0].toFixed(e)&&n[1].toFixed(e)===i[1].toFixed(e)||r.push(n)}return r},r.prototype.formatArea=function(t,e){var r=e.lang,o=void 0===r?"zh":r,n=e.precision,i=void 0===n?2:n,a=L[o];if(t<0)throw new Error("面积值不能为负数");if(i<0||i>10)throw new Error("精度值必须在0-10之间");return t>=v?{val:parseFloat((t/v).toFixed(i)),unit:a.squareKilometer}:t>=1e4?{val:parseFloat((t/1e4).toFixed(i)),unit:a.hectare}:{val:parseFloat(t.toFixed(i)),unit:a.squareMeter}},r.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},r.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},r.prototype.clearAllStateListeners=function(){this.stateListeners=[]},r.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},r}(),E=function(){function r(e,r,o){void 0===r&&(r={units:"meters",precision:2,lang:"zh"}),void 0===o&&(o={});var n=this;this.lineLayer=null,this.drawLayerStyle={color:"red"},this.tempCoords=[],this.markerArr=[],this.totalDistance=0,this.currentState=t.PolygonEditorState.Idle,this.stateListeners=[],this.mapClickEvent=function(t){n.tempCoords.push([t.latlng.lat,t.latlng.lng]),n.calcDistanceAndCreatePopup(n.tempCoords)},this.mapDblClickEvent=function(t){if(n.lineLayer){var e=n.deduplicateCoordinates(n.tempCoords);n.renderLayer(e),n.reset()}},this.mapMouseMoveEvent=function(t){if(n.tempCoords.length){var e=[t.latlng.lat,t.latlng.lng];1===n.tempCoords.length&&(n.tempCoords=[n.tempCoords[0],e]);var r=n.tempCoords.slice(0,n.tempCoords.length-1);n.tempCoords=p(p([],r,!0),[e],!1),n.renderLayer(n.tempCoords)}},this.map=e,this.measureOptions=r,this.map&&(this.updateAndNotifyStateChange(t.PolygonEditorState.Drawing),this.totalDistance=0,this.map.getContainer().style.cursor="crosshair",this.map.doubleClickZoom.disable(),this.initLayers(o),this.initMapEvent(this.map))}return r.prototype.initLayers=function(t){var e=l(l({pane:"overlayPane"},this.drawLayerStyle),t);this.lineLayer=n.polyline([[181,181],[182,182]],e),this.lineLayer.addTo(this.map)},r.prototype.initMapEvent=function(t){t.on("click",this.mapClickEvent),t.on("dblclick",this.mapDblClickEvent),t.on("mousemove",this.mapMouseMoveEvent)},r.prototype.reset=function(){this.tempCoords=[],this.offMapEvent(this.map),this.map.getContainer().style.cursor="grab",this.map.doubleClickZoom.enable(),this.updateAndNotifyStateChange(t.PolygonEditorState.Idle)},r.prototype.renderLayer=function(t){if(!this.lineLayer)throw new Error("图层不存在，无法渲染");this.lineLayer.setLatLngs(t)},r.prototype.geojson=function(){if(this.lineLayer)return this.lineLayer.toGeoJSON();throw new Error("未捕获到图层，无法获取到geojson数据")},r.prototype.destroy=function(){this.lineLayer&&(this.lineLayer.remove(),this.lineLayer=null),this.markerArr&&this.markerArr.length&&this.markerArr.forEach(function(t){t.remove()}),this.markerArr=[],this.reset()},r.prototype.offMapEvent=function(t){t.off("click",this.mapClickEvent),t.off("dblclick",this.mapDblClickEvent),t.off("mousemove",this.mapMouseMoveEvent)},r.prototype.deduplicateCoordinates=function(t,e){if(void 0===e&&(e=6),!Array.isArray(t)||0===t.length)return[];for(var r=[t[0]],o=1;o<t.length;o++){var n=t[o],i=t[o-1];n[0].toFixed(e)===i[0].toFixed(e)&&n[1].toFixed(e)===i[1].toFixed(e)||r.push(n)}return r},r.prototype.calcDistanceAndCreatePopup=function(t){var r=this.deduplicateCoordinates(this.tempCoords).slice(-2);if(1===r.length){var o={pane:"markerPane",icon:this.measureMarkerIcon("zh"===this.measureOptions.lang?"起点":"start point")},i=n.marker(r[0],o).addTo(this.map);this.markerArr.push(i)}if(r.length>=2){var a=e.distance(r[0],r[1],this.measureOptions);this.totalDistance+=a;var s=this.formatDistance(this.totalDistance,this.measureOptions);o={pane:"markerPane",icon:this.measureMarkerIcon(s)},i=n.marker(r[1],o).addTo(this.map);this.markerArr.push(i)}},r.prototype.measureMarkerIcon=function(t){return n.divIcon({className:"measure-distance-marker",html:'<div style="width: 10px;height: 10px; text-align: center; position: relative;">\n                        \x3c!-- 构建小圆点 --\x3e\n                        <div style="width: 10px;height: 10px;border-radius: 50%;background: #ffffff;border: solid 2px red; position: absolute;left: 1px;top: 1px;"></div>\n                        \x3c!-- 下面的内容展示文字 --\x3e\n                        <div style="width: max-content; padding: 3px; border: solid 1px red; background: #ffffff;  position: absolute; left: 10px; top: 10px;">\n                            '.concat("string"==typeof t?t:"".concat(t.val," ").concat(t.unit),"\n                        </div>\n                    </div>")})},r.prototype.formatDistance=function(t,e){var r=e.lang,o=void 0===r?"zh":r,n=e.precision,i=void 0===n?2:n,a=e.units,s=this.normalizeUnit(a);switch(s){case"meters":return this.formatMetricSystem(t,"meters",o,i);case"kilometers":return this.formatMetricSystem(1e3*t,"meters",o,i);case"centimeters":return this.formatMetricSystem(t/100,"meters",o,i);case"millimeters":return this.formatMetricSystem(t/1e3,"meters",o,i);case"miles":return{val:Number(t.toFixed(i)),unit:this.getUnitName("miles",o)};case"nauticalmiles":return{val:Number(t.toFixed(i)),unit:this.getUnitName("nauticalmiles",o)};case"feet":return this.formatFeet(t,o,i);case"yards":return this.formatYards(t,o,i);case"inches":return this.formatInches(t,o,i);case"radians":return{val:Number(t.toFixed(4)),unit:this.getUnitName("radians",o)};case"degrees":return{val:Number(t.toFixed(4)),unit:this.getUnitName("degrees",o)};default:return{val:Number(t.toFixed(i)),unit:this.getUnitName(s,o)}}},r.prototype.normalizeUnit=function(t){return{metres:"meters",millimetres:"millimeters",centimetres:"centimeters",kilometres:"kilometers"}[t]||t},r.prototype.getUnitName=function(t,e){var r;return(null===(r={meters:{en:"meters",zh:"米"},kilometers:{en:"kilometers",zh:"公里"},centimeters:{en:"centimeters",zh:"厘米"},millimeters:{en:"millimeters",zh:"毫米"},miles:{en:"miles",zh:"英里"},nauticalmiles:{en:"nautical miles",zh:"海里"},feet:{en:"feet",zh:"英尺"},yards:{en:"yards",zh:"码"},inches:{en:"inches",zh:"英寸"},radians:{en:"radians",zh:"弧度"},degrees:{en:"degrees",zh:"度"}}[t])||void 0===r?void 0:r[e])||t},r.prototype.formatMetricSystem=function(t,e,r,o){return t>=1e3?{val:Number((t/1e3).toFixed(o)),unit:this.getUnitName("kilometers",r)}:{val:Number(t.toFixed(o)),unit:this.getUnitName("meters",r)}},r.prototype.formatFeet=function(t,e,r){return t<5280?{val:"en"===e?Math.round(t):Number(t.toFixed(r)),unit:this.getUnitName("feet",e)}:{val:Number((t/5280).toFixed(r)),unit:this.getUnitName("miles",e)}},r.prototype.formatYards=function(t,e,r){return t<1760?{val:"en"===e?Math.round(t):Number(t.toFixed(r)),unit:this.getUnitName("yards",e)}:{val:Number((t/1760).toFixed(r)),unit:this.getUnitName("miles",e)}},r.prototype.formatInches=function(t,e,r){return t<12?{val:"en"===e?Math.round(t):Number(t.toFixed(r)),unit:this.getUnitName("inches",e)}:t<63360?{val:Number((t/12).toFixed("en"===e?1:r)),unit:this.getUnitName("feet",e)}:{val:Number((t/63360).toFixed(r)),unit:this.getUnitName("miles",e)}},r.prototype.onStateChange=function(t){this.stateListeners.push(t),t(this.currentState)},r.prototype.offStateChange=function(t){var e=this.stateListeners.indexOf(t);e>-1&&this.stateListeners.splice(e,1)},r.prototype.clearAllStateListeners=function(){this.stateListeners=[]},r.prototype.updateAndNotifyStateChange=function(t){var e=this;this.currentState=t,this.stateListeners.forEach(function(t){return t(e.currentState)})},r}(),S={LeafletCircle:h,MarkerPoint:c,LeafletPolygon:u,LeafletPolyline:d,LeafletRectangle:y,LeafletArea:k,LeafletDistance:E,LeafletRectangleEditor:m,LeafletPolygonEditor:g};t.LeafletArea=k,t.LeafletCircle=h,t.LeafletDistance=E,t.LeafletPolygon=u,t.LeafletPolygonEditor=g,t.LeafletPolyline=d,t.LeafletRectangle=y,t.LeafletRectangleEditor=m,t.MarkerPoint=c,t.default=S,Object.defineProperty(t,"__esModule",{value:!0})});
